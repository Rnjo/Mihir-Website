<!doctype html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>GitHub Commit Counter</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <style>
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
        font-family: Arial, sans-serif;
      }

      .counter-container {
        text-align: center;
        margin: 20px;
      }

      .counter {
        font-size: 2em;
        font-weight: bold;
      }

      .header {
        font-size: 1.5em;
        margin-bottom: 10px;
      }
    </style>
  </head>

  <body>
    <div class="counter-container">
      <div class="header">Total Commits by Rnjo</div>
      <div id="commit-counter" class="counter">Loading...</div>
    </div>

    <script>
      async function fetchCommitCount() {
        const username = "Rnjo";
        const token = "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";
        let totalCommits = 0;

        try {
          // Fetch all repositories for the user
          const reposResponse = await fetch(`https://api.github.com/user/repos`, {
            headers: { Authorization: `token ${token}` }
          });
          const repos = await reposResponse.json();

          if (repos.message) {
            throw new Error(repos.message); // Handle API errors
          }

          // Loop through repositories and sum up commits
          for (const repo of repos) {
            const commitsResponse = await fetch(
              `https://api.github.com/repos/${repo.owner.login}/${repo.name}/stats/contributors`,
              { headers: { Authorization: `token ${token}` } }
            );
            const contributors = await commitsResponse.json();

            // Find the user's commits in the repo
            const userStats = contributors.find(contributor => contributor.author.login === username);
            if (userStats) {
              totalCommits += userStats.total;
            }
          }

          // Display the total commits
          document.getElementById("commit-counter").textContent = totalCommits.toLocaleString();
        } catch (error) {
          console.error("Error fetching commit count:", error);
          document.getElementById("commit-counter").textContent = "Error loading data";
        }
      }

      fetchCommitCount();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  </body>
</html>
